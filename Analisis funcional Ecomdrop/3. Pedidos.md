# Interfaz: Pedidos (con flujo de estados detallado)

## Estructura general
- Mantiene la **estructura base** con **sidebar** y **header** fijos.
- En el sidebar, la opci√≥n activa es **Dropshipper > Pedidos**.
- El contenido variable est√° en el **panel central**, compuesto por filtros, tabs de estados y tabla de pedidos.

---

## Flujo completo del ciclo de vida del pedido

### FASE 1: INGRESO EXTERNO (Cliente ‚Üí Tienda ‚Üí LatinEcom)

#### 1.1 Cliente realiza compra
- El cliente ingresa a la tienda Shopify del dropshipper
- Realiza una compra seleccionando m√©todo de pago:
  - **TC (Tarjeta de Cr√©dito)**: Pago inmediato
  - **COD (Contra Reembolso)**: Pago al recibir

#### 1.2 Sincronizaci√≥n autom√°tica
- La aplicaci√≥n de LatinEcom instalada en Shopify detecta la venta
- **Ingesta autom√°tica** del pedido al sistema LatinEcom
- El pedido aparece en estado **PENDIENTE**

---

### FASE 2: PROCESAMIENTO INTERNO (Sistema LatinEcom)

#### 2.1 Estado: PENDIENTE ‚è≥
- **Descripci√≥n**: Pedido reci√©n ingresado, esperando confirmaci√≥n del dropshipper
- **Acciones disponibles**: 
  - Confirmar pedido
  - Cancelar pedido
- **Restricci√≥n**: No puede despacharse hasta confirmaci√≥n

#### 2.2 Acci√≥n: CONFIRMAR PEDIDO ‚úÖ

El sistema valida el m√©todo de pago y aplica reglas diferentes:

##### Si el pago fue con TARJETA (TC):
**Validaci√≥n de saldo completo:**
```
Saldo requerido = Costo env√≠o + Comisi√≥n plataforma (7%) + Costo producto
```
- ‚úÖ **Saldo suficiente** ‚Üí Estado: **CONFIRMADO**
- ‚ùå **Saldo insuficiente** ‚Üí Estado: **REGISTRAR PAGO**

##### Si el pago es CONTRA REEMBOLSO (COD):
**Validaci√≥n parcial:**
```
Saldo requerido = Solo costo de env√≠o
```
- ‚úÖ **Saldo suficiente** ‚Üí Estado: **CONFIRMADO** 
- ‚ùå **Saldo insuficiente** ‚Üí Estado: **REGISTRAR PAGO**

#### 2.3 Estado: REGISTRAR PAGO üí≥
- **Descripci√≥n**: Pedido retenido por falta de saldo en wallet
- **Soluci√≥n**: El dropshipper debe recargar saldo
- **Acciones disponibles**:
  - Abonar el monto faltante
  - Cancelar pedido
- **Restricci√≥n**: No avanza hasta completar pago
- **Siguiente estado**: Una vez abonado ‚Üí **CONFIRMADO**

#### 2.4 Estado: CONFIRMADO ‚úîÔ∏è
- **Descripci√≥n**: Pedido validado y pagado, listo para preparaci√≥n
- **D√©bitos aplicados en wallet**:
  - Si es TC: env√≠o + comisi√≥n + costo producto
  - Si es COD: solo costo de env√≠o
- **Siguiente estado**: Admin asigna ‚Üí **PREPARADO**

#### 2.5 Estado: PREPARADO üì¶
- **Descripci√≥n**: Producto armado f√≠sicamente para despacho
- **Responsable**: Equipo de fulfillment de LatinEcom
- **Validaci√≥n**: Control de calidad del paquete
- **Siguiente estado**: ‚Üí **DESPACHADO**

#### 2.6 Estado: DESPACHADO üöö
- **Descripci√≥n**: Pedido entregado al courier
- **Informaci√≥n disponible**:
  - N√∫mero de tracking/gu√≠a
  - Empresa de courier
  - Fecha de despacho
- **Siguiente estado**: ‚Üí **ENTREGADO** o **EN REVISI√ìN**

#### 2.7 Estado: ENTREGADO ‚úÖ
- **Descripci√≥n**: Cliente recibi√≥ el pedido exitosamente
- **Acreditaciones en wallet seg√∫n m√©todo de pago**:

##### Si fue pagado con TARJETA (TC):
- No hay movimiento adicional (dropshipper ya cobr√≥ en Shopify)

##### Si fue CONTRA REEMBOLSO (COD):
**Proceso de acreditaci√≥n:**
1. Courier recauda el dinero del cliente
2. Courier deposita en banco
3. Banco acredita a LatinEcom
4. LatinEcom calcula y acredita al dropshipper:
```
Monto acreditado = Venta - Costo producto - Comisi√≥n plataforma (7%) - Comisi√≥n COD (5%)
```
5. Saldo neto disponible en wallet para retiro

#### 2.8 Estado: EN REVISI√ìN üîç
- **Descripci√≥n**: Pedido con incidencias o problemas en la entrega
- **Causas comunes**:
  - Direcci√≥n incorrecta
  - Cliente no disponible
  - Rechazo del paquete
  - Producto da√±ado
- **Acciones disponibles**:
  - Modificar direcci√≥n de entrega
  - Reprogramar entrega
  - Cancelar pedido
- **Siguiente estado**: ‚Üí **ENTREGADO** o **CANCELADO**

#### 2.9 Estado: DEVUELTO üîÑ
- **Descripci√≥n**: Pedido retornado al dep√≥sito
- **Causas**:
  - No se pudo entregar tras varios intentos
  - Cliente rechaz√≥ el pedido
- **Gesti√≥n financiera**:
  - Si fue TC: se eval√∫a reembolso
  - Si fue COD: no hay cobro pendiente

#### 2.10 Estado: CANCELADO ‚ùå
- **Descripci√≥n**: Pedido anulado sin despacho o tras devoluci√≥n
- **Efectos**:
  - Liberaci√≥n de stock reservado
  - No se genera cobro
  - Posible reembolso si aplica
- **Estado final**: No hay acciones posteriores

---

## Modelos de negociaci√≥n validados

### Modelo TC (Tarjeta de Cr√©dito)
| Concepto | Porcentaje | Momento de cobro |
|----------|------------|------------------|
| Costo producto | 100% | Al confirmar |
| Costo env√≠o | 100% | Al confirmar |
| Comisi√≥n plataforma | 7% | Al confirmar |
| **Total descontado** | **107% + env√≠o** | **Confirmaci√≥n** |

### Modelo COD (Contra Reembolso)
| Concepto | Porcentaje | Momento de cobro |
|----------|------------|------------------|
| Costo env√≠o | 100% | Al confirmar |
| Costo producto | 100% | Al entregar (se descuenta de la venta) |
| Comisi√≥n plataforma | 7% | Al entregar |
| Comisi√≥n COD | 5% | Al entregar |
| **Total comisiones** | **12%** | **Al acreditar venta** |

---

## Integraci√≥n con API Externa

### Puntos de cobro disponibles (TC)
- **MercadoPago**: Comisi√≥n 6%
- **Stripe**: Comisi√≥n 3.9% + $0.30
- **PayPal**: Comisi√≥n 5.4% + $0.30

### Integraci√≥n COD con Couriers
- **Andreani**: Cobertura nacional
- **OCA**: Buenos Aires y principales ciudades
- **Correo Argentino**: Cobertura total incluyendo zonas rurales
- **Servicios propios**: AMBA y GBA

---

## Panel central de la interfaz

### 1. Barra de filtros superiores
- **Rango de fechas**: Fecha inicial y final con bot√≥n "Aplicar"
- **Ordenar**: Por fecha, monto, estado
- **M√°s filtros**: 
  - Por m√©todo de pago (TC/COD)
  - Por courier
  - Por tienda conectada
- **Buscar**: Por c√≥digo, cliente, tracking
- **Limpiar**: Resetea todos los filtros

### 2. Tabs de estados (con contadores)
- **Todos**: Vista general
- **Pendiente**: Requieren confirmaci√≥n
- **En revisi√≥n**: Pedidos con problemas
- **A pagar**: En estado "Registrar pago"
- **Con incidencias**: Problemas en entrega
- **Confirmado**: Listos para preparar
- **Preparado**: Listos para despachar
- **Despachado**: En tr√°nsito
- **Entregado**: Completados exitosamente
- **Devuelto**: Retornados al dep√≥sito
- **Cancelado**: Anulados

### 3. Acciones masivas
- **Escanear etiqueta**: Para actualizaci√≥n r√°pida de estados
- **Exportar**: Descarga en CSV/Excel
- **Ver historial**: Timeline completo de cambios

### 4. Tabla de pedidos
Columnas visibles:
- **C√≥digo de pedido**: ID √∫nico clickeable
- **Fecha de creaci√≥n**: Timestamp de ingreso
- **Cliente**: Nombre del comprador
- **Tienda**: Shopify conectado de origen
- **Total**: Monto de la venta
- **Estado**: Badge de color seg√∫n fase
- **Etiqueta**: Tags personalizados
- **Seguimiento**: N√∫mero de tracking (si aplica)
- **Fecha de actualizaci√≥n**: √öltimo cambio

### 5. Panel lateral de detalle (al seleccionar pedido)
- **Resumen**: Totales y ganancias
- **Historial**: Timeline de estados
- **Productos**: Items del pedido
- **Direcci√≥n de entrega**: Datos del destinatario
- **Cliente**: Informaci√≥n de contacto
- **Transporte**: Courier y tracking
- **Modo de pago**: TC o COD
- **Etiquetas**: Tags asignados

---

## Comportamiento esperado del sistema

### Automatizaciones clave
1. **Ingesta autom√°tica** desde Shopify sin intervenci√≥n manual
2. **Validaci√≥n de saldo** instant√°nea al confirmar
3. **D√©bitos autom√°ticos** en wallet seg√∫n reglas de negocio
4. **Acreditaciones autom√°ticas** cuando el courier confirma entrega COD
5. **Notificaciones** en cada cambio de estado importante

### Controles y permisos
- **Dropshipper**: Confirma pedidos, gestiona en revisi√≥n
- **Admin LatinEcom**: Actualiza preparado, despachado, entregado
- **Sistema**: Calcula autom√°ticamente comisiones y saldos

### Trazabilidad completa
- Registro de **todos los movimientos financieros**
- **Historial de estados** con timestamp y usuario
- **Log de modificaciones** en direcciones o datos
- **Tracking de courier** integrado en la plataforma

---

## M√©tricas y KPIs visibles

### En el dashboard
- **Tasa de conversi√≥n**: Confirmados / Pendientes
- **Tasa de entrega**: Entregados / Despachados
- **Tiempo promedio de preparaci√≥n**
- **Valor promedio del pedido**
- **Mix de m√©todos de pago**: % TC vs % COD

### Alertas autom√°ticas
- ‚ö†Ô∏è Pedidos en "Registrar pago" > 24hs
- ‚ö†Ô∏è Pedidos en "En revisi√≥n" > 48hs
- ‚ö†Ô∏è Tasa de cancelaci√≥n > 10%
- ‚ö†Ô∏è Saldo de wallet bajo para confirmaciones